import{h as ot,k as st,K as O,c as f,a as M,t as k,r as h,s as m,f as V,b as nt}from"../chunks/disclose-version.BZrHNTVx.js";import{i as lt,Q as it,m as ut,y as ct,p as L,a2 as dt,t as P,a as X,g as e,s as E,b as q,d as v,a3 as ft,u as ht,c as N}from"../chunks/runtime.C5r0zYmH.js";import{p as Q,i as gt}from"../chunks/props.DX6McTcK.js";import{e as F,i as J}from"../chunks/each.DoOZkgPs.js";import{s as A,h as mt}from"../chunks/attributes.DtTHR9Og.js";import{t as j,m as y}from"../chunks/index.svelte.BH7fYai9.js";import{p as z}from"../chunks/proxy.BBwd8Nu9.js";import{b as vt}from"../chunks/this.CU4v1nvf.js";import{o as pt}from"../chunks/index-client.Du0ho9ko.js";import{d as xt,a as bt,b as W,g as _t}from"../chunks/Message.CZPHAQRJ.js";import{b as wt}from"../chunks/paths.DvFj5Vcm.js";function yt(c,o,...t){var l=c,r,s;lt(()=>{r!==(r=o())&&(s&&(ct(s),s=null),r&&(s=ut(()=>r(l,...t))))},it),ot&&(l=st)}var Mt=k('<div class="flex flex-col px-1 py-0.5 flex-grow"><div class="flex flex-grow cursor-default w-full h-full overflow-hidden relative" role="button" tabindex="0"><div class="flex flex-grow origin-center"><!></div></div></div>');function Ct(c,o){L(o,!0);let t=Q(o,"scale",15,()=>z({current:1,min:.1,max:4,factor:.05})),l=q(null);pt(()=>{var a,g;return(a=e(l))==null||a.addEventListener("wheel",_,{passive:!1}),(g=e(l))==null||g.addEventListener("touchmove",H,{passive:!1}),()=>{var x,S;(x=e(l))==null||x.removeEventListener("wheel",_),(S=e(l))==null||S.removeEventListener("touchmove",H)}});let r=q(null),s=v(()=>e(r)!==null);dt("graph",{startDrag(a){E(r,z(a))},stopDrag(){E(r,null)},isDragging(){return e(s)}});let i=!1,n=z({x:0,y:0});function d(a){n.x+=a.x,n.y+=a.y}function p(a){var g;if(i){d({x:a.movementX,y:a.movementY});return}(g=e(r))==null||g(a)}function b(){E(r,null),i=!1}function C(a){a.button===1&&(i=!0)}function _(a){const{deltaX:g,deltaY:x,clientX:S,clientY:G,ctrlKey:Z,shiftKey:tt}=a;if(Z){a.preventDefault();const $=a.currentTarget.getBoundingClientRect();let et=S/$.width-.5,at=G/$.height-.5;const I=$.width*et,R=$.height*at,rt=t().factor*-Math.sign(x),B=Math.min(Math.max(t().min,t().current+rt),t().max),K=B/t().current;n.x=I-K*(I-n.x),n.y=R-K*(R-n.y),t(t().current=B,!0)}else d(tt?{x:-x,y:0}:{x:-g,y:-x})}let w={x:0,y:0};function Y(a){a.touches.length===1&&(w={x:a.touches[0].clientX,y:a.touches[0].clientY})}function H(a){if(a.preventDefault(),a.touches.length===1){const g=a.touches[0].clientX-w.x,x=a.touches[0].clientY-w.y;w={x:a.touches[0].clientX,y:a.touches[0].clientY},d({x:g,y:x})}}var D=Mt(),u=f(D);vt(u,a=>E(l,z(a)),()=>e(l)),u.__mousemove=p,u.__mouseup=b,u.__mousedown=C,u.__touchstart=Y;var T=f(u),U=f(T);yt(U,()=>o.children),h(T),h(u),h(D),P(()=>{j(u,"cursor-grabbing",e(r)!==null),A(T,"style",`transform: translate(${n.x??""}px, ${n.y??""}px) scale(${t().current??""});`)}),M(c,D),X()}O(["mousemove","mouseup","mousedown","touchstart"]);var Dt=k('<div class="line absolute h-0.5 bg-black dark:bg-white visible svelte-1mutbb5"></div>');function kt(c,o){L(o,!0);let t=v(()=>o.from.data.transform),l=v(()=>o.to.data.transform),r=v(()=>({x:e(l).x+e(l).width/2,y:e(l).y+e(l).height/2})),s=v(()=>({x:e(t).x+e(t).width/2,y:e(t).y+e(t).height/2})),i=v(()=>Math.sqrt(Math.pow(e(s).x-e(r).x,2)+Math.pow(e(s).y-e(r).y,2)));var n=Dt();P(()=>A(n,"style",`
    left: ${e(r).x??""}px;
    top: ${e(r).y??""}px;
    width: ${e(i)??""}px;
    transform: rotate(${Math.atan2(e(s).y-e(r).y,e(s).x-e(r).x)*180/Math.PI}deg);
    `)),M(c,n),X()}var Lt=(c,o,t)=>o(t.drag),Xt=(c,o,t)=>{o(),t.end()},Yt=k('<button class="w-4 h-4 absolute right-2 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10M.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8"></path></svg></button>');function Ht(c,o){L(o,!0);let{startDrag:t,stopDrag:l,isDragging:r}=ft("graph"),s=v(r);var i=Yt();i.__mousedown=[Lt,t,o],i.__mouseup=[Xt,l,o];var n=f(i);f(n),h(n),h(i),P(()=>{j(i,"cursor-grab",!e(s)),j(i,"cursor-grabbing",e(s))}),M(c,i),X()}O(["mousedown","mouseup"]);function St(c,o){y.delete(o().id)}var $t=k('<div class="min-w-24 max-w-96 min-h-12 pt-3 visible absolute bg-gray-200 rounded-md flex items-end justify-center"><!> <button class="w-4 h-4 absolute left-2 top-2 stroke-black"><!></button> <a class="w-4 h-4 absolute left-8 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9q-.13 0-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"></path><path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4 4 0 0 1-.82 1H12a3 3 0 1 0 0-6z"></path></svg></a> <div class="flex w-full h-full justify-center"><div class="p-4 w-full break-all"><article class="grow prose prose-zinc"><!></article></div></div></div>');function Et(c,o){L(o,!0);let t=Q(o,"message",7),l=v(()=>t().data.transform);function r(u){t(t().data.transform.x+=u.movementX,!0),t(t().data.transform.y+=u.movementY,!0)}var s=$t(),i=f(s);Ht(i,{drag:r,end:()=>localStorage.setItem("notes",JSON.stringify(y.export()))});var n=m(m(i,!0));n.__click=[St,t];var d=f(n);mt(d,()=>xt),h(n);var p=m(m(n,!0)),b=f(p),C=f(b);m(C),h(b),h(p);var _=m(m(p,!0)),w=f(_),Y=f(w),H=f(Y),D=v(()=>[_t()]);bt(H,{get md(){return t().data.content},get plugins(){return e(D)}}),h(Y),h(w),h(_),h(s),P(()=>{A(s,"style",`left: ${e(l).x??""}px; top: ${e(l).y??""}px;`),A(p,"href",`${wt??""}/#${t().id??""}`)}),W(s,"offsetWidth",u=>t(t().data.transform.width=u,!0)),W(s,"offsetHeight",u=>t(t().data.transform.height=u,!0)),M(c,s),X()}O(["click"]);var Nt=k("<!> <!>",1);function qt(c,o){L(o,!0),ht(()=>{localStorage.setItem("notes",JSON.stringify(y.export()))}),Ct(c,{children:(t,l)=>{var r=Nt(),s=V(r);F(s,65,()=>Object.values(y.inner),J,(n,d,p)=>{var b=nt(),C=V(b);gt(C,()=>N(d).parent,_=>{kt(_,{get from(){return y.inner[N(d).parent]},get to(){return N(d)}})}),M(n,b)});var i=m(m(s,!0));F(i,65,()=>Object.values(y.inner),J,(n,d,p)=>{Et(n,{get message(){return N(d)}})}),M(t,r)},$$slots:{default:!0}}),X()}export{qt as component};
