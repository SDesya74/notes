var rt=Object.defineProperty;var U=s=>{throw TypeError(s)};var it=(s,t,e)=>t in s?rt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var E=(s,t,e)=>it(s,typeof t!="symbol"?t+"":t,e),j=(s,t,e)=>t.has(s)||U("Cannot "+e);var m=(s,t,e)=>(j(s,t,"read from private field"),e?e.call(s):t.get(s)),L=(s,t,e)=>t.has(s)?U("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),V=(s,t,e,i)=>(j(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),G=(s,t,e)=>(j(s,t,"access private method"),e);import{c as h,r as g,s as b,Q as C,a as B,t as q}from"../chunks/disclose-version.DoApVL7c.js";import{e as lt,u as nt,p as J,f as et,t as st,a as N,H as a,J as z,v as K,a1 as A,w as D,a2 as f}from"../chunks/runtime.DJFpnPC0.js";import{e as Z,i as R}from"../chunks/each.B907KWMQ.js";import{i as vt}from"../chunks/lifecycle.CX1LJLUV.js";import{o as ut}from"../chunks/index-client.D4GGVMv4.js";import{s as ht}from"../chunks/render.RUqgjbxZ.js";import{s as O}from"../chunks/attributes.i701br-n.js";import{p as $}from"../chunks/props.BXINNwbU.js";import{m as at}from"../chunks/index.svelte.BJcAp9c5.js";var x,k,X,P,ot;const W=class W{constructor(t){L(this,P);L(this,x,new WeakMap);L(this,k);L(this,X);V(this,X,t)}observe(t,e){var i=m(this,x).get(t)||new Set;return i.add(e),m(this,x).set(t,i),G(this,P,ot).call(this).observe(t,m(this,X)),()=>{var o=m(this,x).get(t);o.delete(e),o.size===0&&(m(this,x).delete(t),m(this,k).unobserve(t))}}};x=new WeakMap,k=new WeakMap,X=new WeakMap,P=new WeakSet,ot=function(){return m(this,k)??V(this,k,new ResizeObserver(t=>{for(var e of t){W.entries.set(e.target,e);for(var i of m(this,x).get(e.target)||[])i(e)}}))},E(W,"entries",new WeakMap);let T=W;var gt=new T({box:"border-box"});function tt(s,t,e){var i=gt.observe(s,()=>e(s[t]));lt(()=>(nt(()=>e(s[t])),i))}var ft=q('<div class="note min-w-24 max-w-96 min-h-12 relative pt-3 svelte-1w3jgum"><button class="w-4 h-4 absolute right-2 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-move" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10M.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8"></path></svg></button> <button class="w-4 h-4 absolute left-2 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"></path></svg></button> <a class="w-4 h-4 absolute left-8 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9q-.13 0-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"></path><path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4 4 0 0 1-.82 1H12a3 3 0 1 0 0-6z"></path></svg></a> <div class="flex w-full h-full justify-center"><div class="p-4 w-full break-all"> </div></div></div>');function ct(s,t){J(t,!0);let e=$(t,"noteWidth",7),i=$(t,"noteHeight",7);et(()=>{at.updateTransform(t.messageId,{x:t.posX,y:t.posY},e(),i())});function o(v){navigator.clipboard.writeText(v).then(()=>{console.log("Text copied to clipboard")}).catch(c=>{console.error("Failed to copy text: ",c)})}var n=ft(),u=h(n),y=h(u);h(y),g(y),g(u);var p=b(b(u,!0)),M=h(p);h(M),g(M),g(p);var w=b(b(p,!0)),_=h(w),Y=h(_);b(Y),g(_),g(w);var I=b(b(w,!0)),l=h(I),r=h(l);g(l),g(I),g(n),st(()=>{O(n,"style",`
            position: absolute;
            left: ${t.posX??""}px;
            top: ${t.posY??""}px;
          `),O(w,"href",`/#${t.messageId??""}`),ht(r,t.messageContent)}),tt(n,"offsetHeight",v=>i(v)),tt(n,"offsetWidth",v=>e(v)),C("mousedown",u,function(...v){const c=t.onMouseDown;return c==null?void 0:c.apply(this,v)},!1),C("click",p,()=>o(t.messageContent),!1),B(s,n),N()}var dt=q('<div class="line absolute h-0.5 bg-black dark:bg-white svelte-1mutbb5"></div>');function mt(s,t){J(t,!0);let e=96,i=68;et(()=>{let M=at.get(t.messageId).data.transform;console.log(M)});var o=dt();const n=z(()=>t.posLinksX+e/2),u=z(()=>t.posLinksY+i/2),y=z(()=>Math.sqrt(Math.pow(t.posIndexX-t.posLinksX,2)+Math.pow(t.posIndexY-t.posLinksY,2))),p=z(()=>Math.atan2(t.posIndexY-t.posLinksY,t.posIndexX-t.posLinksX)*180/Math.PI);st(()=>O(o,"style",`
    left: ${a(n)}px;
    top: ${a(u)}px;
    width: ${a(y)}px;
    transform: rotate(${a(p)}deg);
    `)),B(s,o),N()}var bt=q('<div class="flex flex-col px-1 py-0.5 flex-grow"><div class="border border-black flex flex-grow cursor-default" style="position: relative;" role="button" tabindex="0"><!> <!></div></div>');function Yt(s,t){J(t,!1);let e=D({}),i=D({}),o=D({});ut(()=>{let l=localStorage.getItem("notes"),r=JSON.parse(l);K(e,r.links),K(i,r.messages);let v=0,c=200,S=new Set,H={};Object.keys(a(i)).map(d=>{if(S.has(a(e)[d]))A(o,a(o)[d]={x:H[a(e)[d]].x+150,y:H[a(e)[d]].y}),H[a(e)[d]].x=H[a(e)[d]].x+150;else{let F=v*100+20,Q=c+100;S.add(a(e)[d]),H[a(e)[d]]={x:Q,y:F},A(o,a(o)[d]={x:Q,y:F}),v++}})});let n=null,u={x:0,y:0};function y(l,r){n=r,u.x=l.clientX-a(o)[r].x,u.y=l.clientY-a(o)[r].y}function p(l){n!==null&&A(o,a(o)[n]={x:l.clientX-u.x,y:l.clientY-u.y})}function M(){n=null}vt();var w=bt(),_=h(w),Y=h(_);Z(Y,1,()=>Object.keys(a(e)),R,(l,r,v)=>{mt(l,{get messageId(){return f(r)},get posIndexX(){return a(o)[f(r)].x},get posIndexY(){return a(o)[f(r)].y},get posLinksX(){return a(o)[a(e)[f(r)]].x},get posLinksY(){return a(o)[a(e)[f(r)]].y},$$legacy:!0})});var I=b(b(Y,!0));Z(I,1,()=>Object.keys(a(i)),R,(l,r,v)=>{ct(l,{get messageId(){return f(r)},get posX(){return a(o)[f(r)].x},get posY(){return a(o)[f(r)].y},get messageContent(){return a(i)[f(r)].content},onMouseDown:c=>y(c,f(r)),$$legacy:!0})}),g(_),g(w),C("mousemove",_,p,!1),C("mouseup",_,M,!1),B(s,w),N()}export{Yt as component};
