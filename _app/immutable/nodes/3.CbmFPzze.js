import{h as et,k as at,K as E,c as d,a as y,t as k,r as c,s as m,f as R,b as rt}from"../chunks/disclose-version.BZrHNTVx.js";import{i as nt,Q as ot,m as st,y as lt,p as D,a2 as it,t as S,a as H,g as e,s as $,b as B,d as v,a3 as ut,u as dt,c as N}from"../chunks/runtime.C5r0zYmH.js";import{p as F,i as ct}from"../chunks/props.DX6McTcK.js";import{e as K,i as V}from"../chunks/each.DoOZkgPs.js";import{s as A,h as ft}from"../chunks/attributes.DtTHR9Og.js";import{t as j,m as _}from"../chunks/index.svelte.BH7fYai9.js";import{p as z}from"../chunks/proxy.BBwd8Nu9.js";import{b as gt}from"../chunks/this.CU4v1nvf.js";import{o as mt}from"../chunks/index-client.Du0ho9ko.js";import{d as vt,a as ht,b as q,g as pt}from"../chunks/Message.BTZMcoix.js";import{b as xt}from"../chunks/paths.CWnAbLKo.js";function bt(u,n,...t){var l=u,r,o;nt(()=>{r!==(r=n())&&(o&&(lt(o),o=null),r&&(o=st(()=>r(l,...t))))},ot),et&&(l=at)}var wt=k('<div class="flex flex-col px-1 py-0.5 flex-grow"><div class="flex flex-grow cursor-default w-full h-full overflow-hidden relative" role="button" tabindex="0"><div class="flex flex-grow origin-center"><!></div></div></div>');function _t(u,n){D(n,!0);let t=F(n,"scale",15,()=>z({current:1,min:.1,max:4,factor:.05})),l=B(null);mt(()=>{var a;return(a=e(l))==null||a.addEventListener("wheel",x,{passive:!1}),()=>{var b;return(b=e(l))==null?void 0:b.removeEventListener("wheel",x)}});let r=B(null),o=v(()=>e(r)!==null);it("graph",{startDrag(a){$(r,z(a))},stopDrag(){$(r,null)},isDragging(){return e(o)}});let i=!1,s=z({x:0,y:0});function f(a){s.x+=a.x,s.y+=a.y}function h(a){var b;if(i){f({x:a.movementX,y:a.movementY});return}(b=e(r))==null||b(a)}function p(){$(r,null),i=!1}function M(a){a.target===a.currentTarget&&(i=!0)}function x(a){const{deltaX:b,deltaY:Y,clientX:J,clientY:W,ctrlKey:Q,altKey:U}=a;if(Q){a.preventDefault();const L=a.currentTarget.getBoundingClientRect();let G=J/L.width-.5,Z=W/L.height-.5;const O=L.width*G,P=L.height*Z,tt=t().factor*-Math.sign(Y),T=Math.min(Math.max(t().min,t().current+tt),t().max),I=T/t().current;s.x=O-I*(O-s.x),s.y=P-I*(P-s.y),t(t().current=T,!0)}else f(U?{x:-Y,y:0}:{x:-b,y:-Y})}var w=wt(),g=d(w);gt(g,a=>$(l,z(a)),()=>e(l)),g.__mousemove=h,g.__mouseup=p,g.__mousedown=M;var C=d(g),X=d(C);bt(X,()=>n.children),c(C),c(g),c(w),S(()=>{j(g,"cursor-grabbing",e(r)!==null),A(C,"style",`transform: translate(${s.x??""}px, ${s.y??""}px) scale(${t().current??""});`)}),y(u,w),H()}E(["mousemove","mouseup","mousedown"]);var yt=k('<div class="line absolute h-0.5 bg-black dark:bg-white visible svelte-1mutbb5"></div>');function Mt(u,n){D(n,!0);let t=v(()=>n.from.data.transform),l=v(()=>n.to.data.transform),r=v(()=>({x:e(l).x+e(l).width/2,y:e(l).y+e(l).height/2})),o=v(()=>({x:e(t).x+e(t).width/2,y:e(t).y+e(t).height/2})),i=v(()=>Math.sqrt(Math.pow(e(o).x-e(r).x,2)+Math.pow(e(o).y-e(r).y,2)));var s=yt();S(()=>A(s,"style",`
    left: ${e(r).x??""}px;
    top: ${e(r).y??""}px;
    width: ${e(i)??""}px;
    transform: rotate(${Math.atan2(e(o).y-e(r).y,e(o).x-e(r).x)*180/Math.PI}deg);
    `)),y(u,s),H()}var Ct=(u,n,t)=>n(t.drag),kt=(u,n,t)=>{n(),t.end()},Dt=k('<button class="w-4 h-4 absolute right-2 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10M.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8"></path></svg></button>');function Ht(u,n){D(n,!0);let{startDrag:t,stopDrag:l,isDragging:r}=ut("graph"),o=v(r);var i=Dt();i.__mousedown=[Ct,t,n],i.__mouseup=[kt,l,n];var s=d(i);d(s),c(s),c(i),S(()=>{j(i,"cursor-grab",!e(o)),j(i,"cursor-grabbing",e(o))}),y(u,i),H()}E(["mousedown","mouseup"]);function Lt(u,n){_.delete(n().id)}var $t=k('<div class="min-w-24 max-w-96 min-h-12 pt-3 visible absolute bg-gray-200 rounded-md flex items-end justify-center"><!> <button class="w-4 h-4 absolute left-2 top-2 stroke-black"><!></button> <a class="w-4 h-4 absolute left-8 top-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9q-.13 0-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"></path><path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4 4 0 0 1-.82 1H12a3 3 0 1 0 0-6z"></path></svg></a> <div class="flex w-full h-full justify-center"><div class="p-4 w-full break-all"><article class="grow prose prose-zinc"><!></article></div></div></div>');function Nt(u,n){D(n,!0);let t=F(n,"message",7),l=v(()=>t().data.transform);function r(a){t(t().data.transform.x+=a.movementX,!0),t(t().data.transform.y+=a.movementY,!0)}var o=$t(),i=d(o);Ht(i,{drag:r,end:()=>localStorage.setItem("notes",JSON.stringify(_.export()))});var s=m(m(i,!0));s.__click=[Lt,t];var f=d(s);ft(f,()=>vt),c(s);var h=m(m(s,!0)),p=d(h),M=d(p);m(M),c(p),c(h);var x=m(m(h,!0)),w=d(x),g=d(w),C=d(g),X=v(()=>[pt()]);ht(C,{get md(){return t().data.content},get plugins(){return e(X)}}),c(g),c(w),c(x),c(o),S(()=>{A(o,"style",`left: ${e(l).x??""}px; top: ${e(l).y??""}px;`),A(h,"href",`${xt??""}/#${t().id??""}`)}),q(o,"offsetWidth",a=>t(t().data.transform.width=a,!0)),q(o,"offsetHeight",a=>t(t().data.transform.height=a,!0)),y(u,o),H()}E(["click"]);var zt=k("<!> <!>",1);function Bt(u,n){D(n,!0),dt(()=>{localStorage.setItem("notes",JSON.stringify(_.export()))}),_t(u,{children:(t,l)=>{var r=zt(),o=R(r);K(o,65,()=>Object.values(_.inner),V,(s,f,h)=>{var p=rt(),M=R(p);ct(M,()=>N(f).parent,x=>{Mt(x,{get from(){return _.inner[N(f).parent]},get to(){return N(f)}})}),y(s,p)});var i=m(m(o,!0));K(i,65,()=>Object.values(_.inner),V,(s,f,h)=>{Nt(s,{get message(){return N(f)}})}),y(t,r)},$$slots:{default:!0}}),H()}export{Bt as component};
